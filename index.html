<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>R&D Recruiting Performance Dashboard · pplwise</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --brand: #2151f5;
      --bg: #f7f7f9;
      --panel: #ffffff;
      --ink: #1a1a1a;
      --muted: #757575;
      --ok: #16a34a;
      --warn: #f59e0b;
      --bad: #ef4444;
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.06);
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }
    
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo {
      display: grid;
      place-items: center;
      width: 38px;
      height: 38px;
      border-radius: 10px;
      background: var(--brand);
      color: #fff;
      font-weight: 700;
    }
    
    .title h1 {
      font-size: 20px;
      margin: 0;
    }
    
    .title .sub {
      font-size: 12px;
      color: var(--muted);
    }
    
    .toolbar {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    select, .btn {
      appearance: none;
      border: 1px solid #e6e6ea;
      background: #fff;
      border-radius: 10px;
      padding: 9px 10px;
      font: inherit;
    }
    
    .btn {
      background: var(--brand);
      color: #fff;
      border: none;
      box-shadow: var(--shadow);
      cursor: pointer;
    }
    
    .grid {
      display: grid;
      gap: 14px;
    }
    
    .grid.kpis {
      grid-template-columns: repeat(7, minmax(0, 1fr));
    }
    
    @media (max-width: 1100px) {
      .grid.kpis {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }
    
    @media (max-width: 640px) {
      .grid.kpis {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    
    .card {
      background: var(--panel);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    
    .card.pad {
      padding: 16px;
    }
    
    .kpi {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .kpi .label {
      font-size: 12px;
      color: var(--muted);
    }
    
    .kpi .value {
      font-size: 26px;
      font-weight: 700;
    }
    
    .kpi .change {
      font-size: 13px;
      font-weight: 600;
      margin-top: 4px;
    }
    
    .kpi .change.positive {
      color: var(--ok);
    }
    
    .kpi .change.negative {
      color: var(--bad);
    }
    
    .kpi .change.neutral {
      color: var(--muted);
    }
    
    .section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 14px;
    }
    
    @media (max-width: 960px) {
      .section {
        grid-template-columns: 1fr;
      }
    }
    
    @media print {
      body {
        background: white;
      }
      .container {
        max-width: 100%;
        padding: 10px;
      }
      .btn {
        display: none;
      }
    }
    
    .table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 4px;
      table-layout: fixed;
    }
    
    .table th {
      font-size: 12px;
      color: var(--muted);
      text-align: center;
      padding: 6px;
    }
    
    .table td {
      background: #fff;
      padding: 6px;
      text-align: center;
      word-wrap: break-word;
    }
    
    .table tr td:first-child {
      border-top-left-radius: 10px;
      border-bottom-left-radius: 10px;
      text-align: left;
    }
    
    .table tr td:last-child {
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
      text-align: left;
    }
    
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 7px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
    }
    
    .ok {
      background: rgba(22, 163, 74, .12);
      color: var(--ok);
    }
    
    .warn {
      background: rgba(245, 158, 11, .12);
      color: var(--warn);
    }
    
    .bad {
      background: rgba(239, 68, 68, .12);
      color: var(--bad);
    }
    
    .new {
      background: #fff;
      color: var(--muted);
      border: 1px solid #e5e7eb;
    }
    
    .filled {
      background: var(--brand);
      color: #fff;
    }
    
    .error {
      display: none;
      margin: 10px 0;
      padding: 8px 10px;
      border-radius: 10px;
      background: #fff3cd;
      color: #7a5d00;
      border: 1px solid #ffe69c;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">pw</div>
        <div class="title">
          <h1>R&D Recruiting Performance Dashboard</h1>
          <div class="sub">Live view · powered by pplwise · <span id="lastUpdated"></span></div>
        </div>
      </div>
      <div class="toolbar">
        <select id="roleSelect" title="Select role">
          <option value="all">All roles</option>
        </select>
        <select id="weekSelect" title="Select week"></select>
        <button class="btn" id="exportBtn">Export as PDF</button>
      </div>
    </header>

    <div id="err" class="error"></div>

    <div class="grid kpis" id="kpiGrid"></div>

    <div class="section">
      <div class="card pad">
        <h3 style="margin:0 0 10px 0;font-size:14px;color:var(--muted)">Recruiting Activity</h3>
        <canvas id="funnelChart" style="max-height:180px"></canvas>
      </div>
      <div class="card pad">
        <h3 style="margin:0 0 10px 0;font-size:14px;color:var(--muted)">Weekly Activity</h3>
        <canvas id="trendChart" style="max-height:180px"></canvas>
      </div>
    </div>

    <div class="card pad" style="margin-top:14px">
      <h3 style="margin:0 0 10px 0;font-size:14px;color:var(--muted)">Pipeline Health</h3>
      <table class="table" id="healthTable">
        <colgroup>
          <col style="width:22%"><col style="width:8%">
          <col style="width:8%"><col style="width:8%"><col style="width:8%"><col style="width:8%"><col style="width:8%">
          <col style="width:12%"><col style="width:18%">
        </colgroup>
        <thead>
          <tr>
            <th>Role</th>
            <th>DC</th>
            <th>HM IV</th>
            <th>Task</th>
            <th>Final</th>
            <th>Offer</th>
            <th>Hired</th>
            <th>Status</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card pad" style="margin-top:14px" id="notesCard">
      <h3 style="margin:0 0 10px 0;font-size:14px;color:var(--muted)">Highlights / Challenges / Outreach Priorities</h3>
      <div id="notes"></div>
    </div>
  </div>

  <script>
    // Data structure
    const data = {
      weeks: [
        "w/c 13 Oct 2025", "w/c 20 Oct 2025",
        "w/c 27 Oct 2025", "w/c 03 Nov 2025",
        "w/c 10 Nov 2025", "w/c 17 Nov 2025", "w/c 24 Nov 2025"
      ],
      
      roles: [
        "Senior AI Engineer",
        "Senior Backend Engineer",
        "Keycloak Expert"
      ],
      
      weekly: {
        "Senior AI Engineer": {
          Sourced: [0, 0, 17, 5, 13, 0, 24],
          Discovery: [0, 0, 0, 5, 5, 7, 4],
          HM: [0, 0, 0, 0, 0, 4, 4],
          Case: [0, 0, 0, 0, 0, 0, 0],
          CEO: [0, 0, 0, 0, 0, 0, 0],
          Offer: [0, 0, 0, 0, 0, 0, 0],
          Hired: [0, 0, 0, 0, 0, 0, 0]
        },
        
        "Senior Backend Engineer": {
          Sourced: [0, 0, 0, 0, 0, 0, 18],
          Discovery: [0, 0, 0, 0, 7, 6, 2],
          HM: [0, 0, 0, 0, 0, 3, 2],
          Case: [0, 0, 0, 0, 0, 0, 2],
          CEO: [0, 0, 0, 0, 0, 0, 0],
          Offer: [0, 0, 0, 0, 0, 0, 0],
          Hired: [0, 0, 0, 0, 0, 0, 0]
        },
        
        "Keycloak Expert": {
          Sourced: [0, 0, 0, 0, 52, 48, 0],
          Discovery: [0, 0, 0, 0, 0, 5, 3],
          HM: [0, 0, 0, 0, 0, 0, 3],
          Case: [0, 0, 0, 0, 0, 0, 1],
          CEO: [0, 0, 0, 0, 0, 0, 0],
          Offer: [0, 0, 0, 0, 0, 0, 0],
          Hired: [0, 0, 0, 0, 0, 0, 0]
        }
      },
      
      health: {
        // Week index 5 (w/c 17 Nov 2025)
        5: [
          { role: "Senior AI Engineer", status: "new", discovery: 7, hm: 4, task: 0, final: 0, offer: 0, hired: "0/1", note: "" },
          { role: "Senior Backend Engineer", status: "new", discovery: 6, hm: 3, task: 0, final: 0, offer: 0, hired: "0/1", note: "" },
          { role: "Keycloak Expert", status: "new", discovery: 5, hm: 0, task: 0, final: 0, offer: 0, hired: "0/1", note: "" }
        ],
        // Week index 6 (w/c 24 Nov 2025) - default for other weeks
        default: [
          { role: "Senior AI Engineer", status: "new", discovery: 4, hm: 4, task: 0, final: 0, offer: 0, hired: "0/1", note: "" },
          { role: "Senior Backend Engineer", status: "new", discovery: 2, hm: 2, task: 2, final: 0, offer: 0, hired: "0/1", note: "" },
          { role: "Keycloak Expert", status: "new", discovery: 3, hm: 3, task: 1, final: 0, offer: 0, hired: "0/1", note: "" }
        ]
      },
      
      notes: {
        // Week index 5 (w/c 17 Nov 2025)
        5: {
          highlights: [""],
          challenges: [""],
          priorities: [""]
        },
        // Week index 6 (w/c 24 Nov 2025) - current week
        6: {
          highlights: ["Great collaboration between Talent and Engineering, Axel reviewing shortlists superfast"],
          challenges: ["Language barriers. Therefore adapted outreach strategy to Spain, Portugal, Germany and UK"],
          priorities: ["1 Keycloak Expert", "2 Senior AI Engineer", "3 Senior Backend Engineer"]
        },
        // Default for other weeks
        default: {
          highlights: [""],
          challenges: [""],
          priorities: [""]
        }
      }
    };

    // Utility functions
    const err = document.getElementById('err');
    window.addEventListener('error', e => {
      err.style.display = 'block';
      err.textContent = e.message;
    });
    
    document.getElementById('lastUpdated').textContent = new Date().toLocaleDateString('en-GB', {
      day: '2-digit',
      month: 'short',
      year: 'numeric'
    });

    const roleSel = document.getElementById('roleSelect');
    data.roles.forEach(r => {
      const o = document.createElement('option');
      o.value = r;
      o.textContent = r;
      roleSel.appendChild(o);
    });
    
    const weekSel = document.getElementById('weekSelect');
    data.weeks.forEach((w, i) => {
      const o = document.createElement('option');
      o.value = i;
      o.textContent = w;
      weekSel.appendChild(o);
    });
    weekSel.value = String(data.weeks.length - 1);

    const asAll = v => !v || v === 'all' || !data.roles.includes(v);
    const safe = n => Number.isFinite(+n) ? +n : 0;

    function totalsFor(weekIndex, role) {
      const keys = ['Sourced', 'Discovery', 'HM', 'Case', 'Final', 'Offer', 'Hired'];
      const t = Object.fromEntries(keys.map(k => [k, 0]));
      const roles = asAll(role) ? data.roles : [role];
      
      roles.forEach(r => {
        keys.forEach(k => {
          // Map CEO to Final for backward compatibility
          const dataKey = k === 'Final' ? 'CEO' : k;
          t[k] += safe((data.weekly[r][dataKey] || [])[weekIndex]);
        });
      });
      
      return t;
    }

    // KPI rendering
    const kpiGrid = document.getElementById('kpiGrid');
    const kpis = [
      { key: 'Sourced', label: 'Candidates Sourced' },
      { key: 'Discovery', label: 'Discovery Calls' },
      { key: 'HM', label: 'HM Interviews' },
      { key: 'Case', label: 'Case Studies' },
      { key: 'Final', label: 'Final' },
      { key: 'Offer', label: 'Offers' },
      { key: 'Hired', label: 'Hires' }
    ];

    function renderKPIs() {
      const weekIndex = +weekSel.value;
      const t = totalsFor(weekIndex, roleSel.value);
      const tPrev = weekIndex > 0 ? totalsFor(weekIndex - 1, roleSel.value) : null;
      
      kpiGrid.innerHTML = '';
      
      kpis.forEach(k => {
        const el = document.createElement('div');
        el.className = 'card pad kpi';
        
        let changeHtml = '';
        if (tPrev) {
          const current = t[k.key];
          const previous = tPrev[k.key];
          
          if (previous === 0 && current === 0) {
            changeHtml = '<div class="change neutral">– vs last wk</div>';
          } else if (previous === 0 && current > 0) {
            changeHtml = '<div class="change positive">+∞% vs last wk</div>';
          } else if (previous > 0) {
            const percentChange = ((current - previous) / previous * 100).toFixed(1);
            const changeClass = percentChange > 0 ? 'positive' : percentChange < 0 ? 'negative' : 'neutral';
            const sign = percentChange > 0 ? '+' : '';
            changeHtml = `<div class="change ${changeClass}">${sign}${percentChange}% vs last wk</div>`;
          } else {
            changeHtml = '<div class="change neutral">– vs last wk</div>';
          }
        } else {
          changeHtml = '<div class="change neutral">– vs last wk</div>';
        }
        
        el.innerHTML = `
          <div class="label">${k.label}</div>
          <div class="value">${t[k.key]}</div>
          ${changeHtml}
        `;
        kpiGrid.appendChild(el);
      });
    }

    // Chart rendering
    let funnelChart, trendChart;
    
    function renderFunnel() {
      const t = totalsFor(+weekSel.value, roleSel.value);
      const stages = ['Sourced', 'Discovery', 'HM', 'Case', 'Final', 'Offer', 'Hired'];
      const vals = stages.map(s => t[s]);
      
      if (funnelChart) funnelChart.destroy();
      
      funnelChart = new Chart(document.getElementById('funnelChart'), {
        type: 'bar',
        data: {
          labels: stages,
          datasets: [{
            data: vals,
            backgroundColor: stages.map((_, i) => `hsl(${(i * 36) % 360} 80% 65% / .9)`),
            borderRadius: 10
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    function renderTrend() {
      const stages = ['Sourced', 'Discovery', 'HM', 'Final', 'Offer', 'Hired'];
      const roles = asAll(roleSel.value) ? data.roles : [roleSel.value];
      
      // Get current week index and calculate last 4 weeks
      const currentWeekIndex = +weekSel.value;
      const startIndex = Math.max(0, currentWeekIndex - 3);
      const endIndex = currentWeekIndex + 1;
      
      // Filter weeks and data for last 4 weeks
      const displayWeeks = data.weeks.slice(startIndex, endIndex);
      const series = Object.fromEntries(stages.map(s => [s, Array(displayWeeks.length).fill(0)]));
      
      roles.forEach(r => {
        stages.forEach(s => {
          // Map Final to CEO for backward compatibility
          const dataKey = s === 'Final' ? 'CEO' : s;
          const weekData = data.weekly[r][dataKey] || [];
          weekData.slice(startIndex, endIndex).forEach((v, i) => series[s][i] += safe(v));
        });
      });
      
      const datasets = stages.map((s, i) => ({
        label: s,
        data: series[s],
        tension: .35,
        fill: false,
        borderColor: `hsl(${i * 60} 70% 45%)`,
        pointRadius: 2.5
      }));
      
      if (trendChart) trendChart.destroy();
      
      trendChart = new Chart(document.getElementById('trendChart'), {
        type: 'line',
        data: { labels: displayWeeks, datasets },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: { legend: { position: 'bottom', labels: { boxWidth: 12, padding: 8, font: { size: 10 } } } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    // Table rendering
    function renderHealth() {
      const tbody = document.querySelector('#healthTable tbody');
      tbody.innerHTML = '';
      const weekIndex = +weekSel.value;
      
      // Get health data for the selected week (use default if week not defined)
      const healthData = data.health[weekIndex] || data.health.default;
      let rows = healthData.filter(h => asAll(roleSel.value) || h.role === roleSel.value);
      
      // Sort: on hold first, then filled, then open roles (ok, warn, bad)
      rows.sort((a, b) => {
        const order = { 'hold': 1, 'filled': 2, 'ok': 3, 'warn': 3, 'bad': 3, 'new': 4 };
        return (order[a.status] || 4) - (order[b.status] || 4);
      });
      
      rows.forEach(h => {
        const tr = document.createElement('tr');
        const tag = h.status === 'filled' ? 'filled' :
                    h.status === 'ok' ? 'ok' :
                    h.status === 'warn' ? 'attention' :
                    h.status === 'bad' ? 'critical' :
                    h.status === 'hold' ? 'on hold' :
                    h.status === 'new' ? 'new' : h.status;
        const cls = h.status === 'filled' ? 'filled' :
                    h.status === 'ok' ? 'ok' :
                    h.status === 'warn' ? 'warn' :
                    h.status === 'bad' ? 'bad' : 
                    h.status === 'hold' ? 'warn' : 'new';
        
        tr.innerHTML = `
          <td>${h.role}</td>
          <td>${h.discovery || 0}</td>
          <td>${h.hm || 0}</td>
          <td>${h.task || 0}</td>
          <td>${h.final || 0}</td>
          <td>${h.offer || 0}</td>
          <td>${h.hired || 0}</td>
          <td><span class="badge ${cls}">${tag}</span></td>
          <td style="text-align:left">${h.note || ''}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function renderNotes() {
      const weekIndex = +weekSel.value;
      const notesData = data.notes[weekIndex] || data.notes.default;
      const n = notesData;
      const notesContainer = document.getElementById('notes');
      const notesCard = document.getElementById('notesCard');
      
      // Check if all notes are empty
      const allEmpty = n.highlights.every(x => !x || x.trim() === '') && 
                       n.challenges.every(x => !x || x.trim() === '') && 
                       n.priorities.every(x => !x || x.trim() === '');
      
      if (allEmpty) {
        notesCard.style.padding = '12px 16px';
        notesContainer.innerHTML = '<div style="color:var(--muted);font-size:12px">No notes available</div>';
        return;
      }
      
      notesCard.style.padding = '16px';
      notesContainer.innerHTML = `
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;align-items:start">
          <div>
            <h4 style="margin:0 0 8px 0;font-size:13px">Highlights</h4>
            <ul style="margin:0;padding-left:18px;font-size:13px;min-height:20px">${n.highlights.filter(x => x && x.trim()).map(x => `<li>${x}</li>`).join('') || '<li style="color:var(--muted)">–</li>'}</ul>
          </div>
          <div>
            <h4 style="margin:0 0 8px 0;font-size:13px">Challenges</h4>
            <ul style="margin:0;padding-left:18px;font-size:13px;min-height:20px">${n.challenges.filter(x => x && x.trim()).map(x => `<li>${x}</li>`).join('') || '<li style="color:var(--muted)">–</li>'}</ul>
          </div>
          <div>
            <h4 style="margin:0 0 8px 0;font-size:13px">Outreach Priorities</h4>
            <ul style="margin:0;padding-left:18px;font-size:13px;min-height:20px">${n.priorities.filter(x => x && x.trim()).map(x => `<li>${x}</li>`).join('') || '<li style="color:var(--muted)">–</li>'}</ul>
          </div>
        </div>
      `;
    }

    // Main render function
    function renderAll() {
      renderKPIs();
      renderFunnel();
      renderTrend();
      renderHealth();
      renderNotes();
    }

    // Event listeners
    document.getElementById('exportBtn').addEventListener('click', () => window.print());
    roleSel.addEventListener('change', renderAll);
    weekSel.addEventListener('change', renderAll);

    // Initial render
    renderAll();
  </script>
</body>
</html>